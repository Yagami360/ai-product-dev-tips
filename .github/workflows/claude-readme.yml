name: Upsert README automatically by Claude Code

on:
  push:
    branches: [main, master]
    paths-ignore:
      - 'README_claude.md'
      - '.github/**'

env:
  # README_FILE: README.md
  README_FILE: README_claude.md

jobs:
  upsert-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Git
        run: |
          git config --global user.name "readme-bot[bot]"
          git config --global user.email "readme-bot[bot]@users.noreply.github.com"

      - name: Upsert README with Claude
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          claude_args: |
            --allowedTools "Bash(ls -la *),Bash(cat *),Bash(find . -name '*' -type f),Bash(head -20 *),Bash(tree -L 2),Bash(git add ${{ env.README_FILE }}),Bash(git commit -m *),Bash(git push)"
            --system-prompt "ãƒªãƒã‚¸ãƒˆãƒªã‚’åˆ†æã—ã¦ã€${{ env.README_FILE }}ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

            ## æœ€åˆã«å®Ÿè¡Œã™ã‚‹ã“ã¨ï¼š
            1. '${{ env.README_FILE }}'ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ (ls -la ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèª)
            2. å­˜åœ¨ã™ã‚‹å ´åˆã¯å†…å®¹ã‚’ç¢ºèª (cat ${{ env.README_FILE }})
            3. ãƒªãƒã‚¸ãƒˆãƒªã®æ§‹é€ ã‚’åˆ†æ (ls -la, find . -name '*.py' -o -name '*.js' -o -name '*.md' | head -20)

            ## READMEä½œæˆ/æ›´æ–°ã®æ–¹é‡ï¼š
            **ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼ˆæ–°è¦ä½œæˆï¼‰:**
            - ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’è©³ç´°ã«åˆ†æ
            - ä»¥ä¸‹ã®æ§‹é€ ã§åŒ…æ‹¬çš„ãªREADMEã‚’ä½œæˆï¼š
              # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
              ## ğŸ“‹ æ¦‚è¦
              ## âœ¨ ç‰¹å¾´
              ## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
              ## ğŸ“¦ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
              ## ğŸš€ ä½¿ç”¨æ–¹æ³•
              ## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
              ## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
              ## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

            **ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼ˆæ›´æ–°ï¼‰:**
            - æ—¢å­˜ã®æ§‹é€ ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒ
            - æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆå¤‰æ›´å†…å®¹ã‚’åæ˜ 
            - æ–°æ©Ÿèƒ½ã‚„å¤‰æ›´ç‚¹ã‚’é©åˆ‡ã«è¿½åŠ ãƒ»ä¿®æ­£
            - å¤ããªã£ãŸæƒ…å ±ã‚’æ›´æ–°

            ## åˆ†æã™ã¹ãè¦ç´ ï¼š
            - package.json, requirements.txt, Cargo.toml, go.modç­‰ã®ä¾å­˜é–¢ä¿‚
            - ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä¸»è¦æ©Ÿèƒ½
            - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆDocker, CI/CDç­‰ï¼‰
            - æ—¢å­˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
            - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

            ## é‡è¦ãªæŒ‡ç¤ºï¼š
            - å¸¸ã«æ—¥æœ¬èªã§è¨˜è¿°
            - å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æã—ã¦æ­£ç¢ºãªæƒ…å ±ã‚’è¨˜è¼‰
            - ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯å®Ÿéš›ã«å‹•ä½œã™ã‚‹ã‚‚ã®ã‚’æä¾›
            - ä½œæˆ/æ›´æ–°å¾Œã¯å¿…ãšgitã§ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥
            - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä½œæˆã‹æ›´æ–°ã‹ã‚’æ˜ç¢ºã«ç¤ºã™

            ä½œæ¥­ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ï¼"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
