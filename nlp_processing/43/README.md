# Microsoft Agent Framework のワークフローを使用してマルチ Agent での簡単な並列処理を行う

## 方法

### 事前準備

1. Microsoft Agent Framework をインストールする

    ```bash
    pip install agent-framework
    ```

1. ワークフロー可視化のための graphviz をインストールする

    - Ubuntu の場合

        ```bash
        sudo apt-get install graphviz
        ```

    - Mac OS の場合

        ```bash
        brew install graphviz
        ```

    - conda を使用する場合

        ```bash
        conda install -c conda-forge graphviz python-graphviz
        ```

### Azure OpenAPI で動かす場合

1. Azure の Azure OpenAPI からリソース作成する

    <img width="800" alt="Image" src="https://github.com/user-attachments/assets/eac99545-adab-478a-a207-be193024e4a3" />

    [Azure OpenAPI] -> [モデルのデプロイ] の流れで作成

1. 環境変数を設定する

    ```bash
    export AZURE_OPENAI_ENDPOINT="dummy"
    export AZURE_OPENAI_CHAT_DEPLOYMENT_NAME="dummy"
    export AZURE_OPENAI_API_KEY="dummy"
    ```

1. Microsoft Agent Framework を使用したコードを実装する

    [run.py](run.py)

    ポイントは、以下の通り

    - 以下の３つの AI Agent の並列処理から構成されるマルチエージェントのワークフローになっている

        - Researcher の AI Agent
            - プロンプトで市場調査と製品調査の専門家と指示しただけの簡単な AI Agent

        - Marketer の AI Agent
            - プロンプトでマーケティング戦略家と指示しただけの簡単な AI Agent

        - Legal の AI Agent
            - プロンプトで法務・コンプライアンスレビュアーと指示しただけの簡単な AI Agent

1. Microsoft Agent Framework を使用したコードを実行する

    ```bash
    python run.py
    ```

    ```bash
    入力プロンプト:  新しい価格帯の電動自転車を都市部での通勤に向けて発売することについて、市場調査と製品調査を行ってください。
    ===== 最終的な応答 (messages) =====
    ------------------------------------------------------------

    01 [user]:
    新しい価格帯の電動自転車を都市部での通勤に向けて発売することについて、市場調査と製品調査を行ってください。
    ------------------------------------------------------------

    02 [researcher]:
    ### 洞察
    1. **都市部の通勤需要**: COVID-19の影響でリモート勤務が増えたものの、都市部では依然として通勤手段としての自転車の需要が高まっています。環境意識の向上もあいまって、電動自転車は人気が上昇しています。
    
    2. **価格帯**: 新しい価格帯が中価格帯の電動自転車であれば、より多くの消費者が手に入れやすくなります。特に都市部の若年層や中堅世代をターゲットにすることが考えられます。

    3. **競合状況**: 複数のブランドがすでに市場に存在しており、機能やデザインでの差別化が重要です。競合他社の価格設定や特徴を分析する必要があります。

    ### 機会
    1. **サブスクリプションモデル**: 都市部のユーザー向けに、短期間のレンタルやサブスクリプションサービスを提供することで、初期投資を抑えたい消費者層を取り込むことが可能です。

    2. **アプリ連携とスマート機能**: GPS追跡、盗難防止、健康管理機能などのスマート技術を搭載することで、若年層の関心を引けます。

    3. **政府の支援**: 環境対策としての政策により、電動自転車購入への補助金が出る場合があるため、これを活用することで価格競争力が向上します。

    ### リスク
    1. **競争の激化**: 既存のブランドとの競争が激しく、価格や機能での差別化が難しい場合、市場シェアを獲得できないリスクがあります。

    2. **需要の変動**: 都市部の交通政策やCOVID-19の影響など、外部要因により需要が変動する可能性があるため、慎重な需要予測が必要です。

    3. **品質とパフォーマンス**: 中価格帯の設定は品質に対する消費者期待を引き上げるため、製品の性能や耐久性が期待に応えられない場合、ブランドイメージに影響を与えるリスクがあります。

    これらの要素を踏まえた上で、戦略を検討することが重要です。
    ------------------------------------------------------------

    03 [marketer]:
    ## 市場調査と製品調査

    ### 市場調査

    1. **ターゲット市場の特定**
    - 若年層（20～35歳）: 環境意識が高く、流行に敏感な世代。
    - 中堅層（35～50歳）: 健康志向が高く、利便性を求める忙しいビジネスマン。
    - 環境に配慮する高齢者: アクティブな生活を送りたい方々。

    2. **競合分析**
    - 競合他社の価格帯、スペック、ブランドイメージを調査。
    - ユーザーからのフィードバックを収集し、値段に対するパフォーマンスの期待値を確認。

    3. **消費者のニーズと欲求**
    - 環境への配慮（CO2削減）。
    - 通勤や買い物時の経済性（燃費やメンテナンスコスト）。
    - スポーティなデザインやカスタマイズの自由度。

    4. **トレンド分析**
    - 都市部での自転車利用の増加。
    - パンデミック後の徒歩・サイクリングの人気上昇。
    - 生活様式の変化によるデジタル化ニーズの増大。

    ### 製品調査

    1. **製品スペック**
    - 視認性の高いデザインとエルゴノミクスに基づいた快適性。
    - 長距離走行を可能にするバッテリー寿命（50km以上）。
    - スマホ連携機能（GPS追跡アプリ、盗難防止機能）。

    2. **価格設定**
    - 競合製品の価格帯をリサーチし、エントリーモデルから上級モデルまでの複数の価格帯を設定。
    - 購入者への長期的な価値を示すためのリースオプションや分割払いの導入。

    3. **ブランディングとメッセージング**
    - 「サステナブルな未来を共に築く」: 環境に優しい移動手段を提供し、持続可能な社会の実現に寄与するメッセージ。

    ## 魅力的な価値提案とターゲットメッセージ

    ### バリュープロポジション
    「通勤をもっと快適に、もっとエコに。私たちの電動自転車は、都市部の喧騒を楽しむあなたにぴったりの乗り物です。高性能バッテリーと洗練されたデザインで、ストレスフリーな通勤体験を提供します。」

    ### ターゲットメッセージ
    「環境に優しい未来を選びたいあなたに。私たちの新しい電動自転車は、渋滞知らずで、日々の通勤をもっと楽しく、効率的にします。今すぐ新しいライフスタイルを始めましょう！」 

    このように、市場調査と製品調査に基づいてターゲットとなる消費者に響く価値提案とメッセージを構築することが大切です。
    ------------------------------------------------------------

    04 [legal]:
    新しい価格帯の電動自転車を都市部での通勤向けに発売する際、法務・コンプライアンスの観点からいくつかの制約、免責事項、およびポリシー上の懸念事項を強調する必要があります。

    ### 制約事項

    1. **法規制の遵守**:
    - 電動自転車に関する地域の法律や規制（電力制限、速度制限、装備要件など）を遵守する必要があります。
    - 特に都市部では、特定の道路や区域で自転車の利用が制限されている場合があります。

    2. **消費者保護法**:
    - 商品の広告や販売において誤解を招かないよう、正確な情報提供が求められます（性能、価格、アフターサービスに関する情報など）。

    3. **環境規制**: 
    - 環境への影響を考慮し、製品の消費電力、バッテリーの製造・処理に関する規制を遵守する必要があります。

    ### 免責事項

    1. **責任の制限**: 
    - 製品の使用に伴う事故や怪我に関して事前に適切な免責事項を設定し、使用者が製品の利用に際してリスクを理解することを明確にする必要があります。

    2. **パフォーマンスの保証**:
    - 製品に関する保証やアフターサービスにおいて、期待されるパフォーマンスを保証しない旨の明確な説明が必要です。

    ### ポリシー上の懸念事項

    1. **データプライバシー**:
    - 電動自転車に関連するアプリやデジタルサービスを提供する場合、ユーザーのデータ収集と利用に関してプライバシーポリシーを明確にし、ユーザーからの同意を得る必要があります。

    2. **透明性**:
    - 製品の共同購入やサブスクリプションモデルがある場合、取引条件を透明にし、顧客に十分な情報を提供することが求められます。

    3. **モニタリングとフィードバック**:
    - 市場での反応をデータとして集める際の倫理的配慮として、ユーザーからのフィードバックを公正に扱うことが必要です。データの取り扱いや顧客の同意に関する方針が重要です。

    以上の点を考慮しながら、適切な市場調査と製品調査を行い、法的なリスクを軽減し、健全な商品提供を目指すことが重要です。
    ```

    ３つつのマルチ AI Agent それぞれで回答を出力し集約している簡単なマルチエージェントシステムになっていることがわかる

    ```mermaid
    flowchart TD
        dispatcher["dispatcher (Start)"];
        researcher["researcher"];
        marketer["marketer"];
        legal["legal"];
        aggregator["aggregator"];
        fan_in__aggregator__e3a4ff58((fan-in))
        legal --> fan_in__aggregator__e3a4ff58;
        marketer --> fan_in__aggregator__e3a4ff58;
        researcher --> fan_in__aggregator__e3a4ff58;
        fan_in__aggregator__e3a4ff58 --> aggregator;
        dispatcher --> researcher;
        dispatcher --> marketer;
        dispatcher --> legal;
    ```

## 参考サイト

- https://learn.microsoft.com/ja-jp/agent-framework/user-guide/workflows/orchestrations/overview
- https://learn.microsoft.com/ja-jp/agent-framework/user-guide/workflows/orchestrations/concurrent?pivots=programming-language-python
